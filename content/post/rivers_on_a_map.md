---
title: "Drawing rivers on a map"
date: 2023-02-10T21:33:52+02:00
draft: true
tags: ["map", "river"]

---

* How to __[Loading Data from OpenStreetMap with Python and the Overpass API](https://towardsdatascience.com/loading-data-from-openstreetmap-with-python-and-the-overpass-api-513882a27fd0)__:
  * Describes the OSM Data Model (3 basic components are nodes, ways and relations),
  * how to build and test queries using the Overpass API using Overpass Turbo,
  * and how to use Python to get the data

```python
import requests
import json
overpass_url = "http://overpass-api.de/api/interpreter"
overpass_query = """
[out:json];
area["ISO3166-1"="DE"][admin_level=2];
(node["amenity"="biergarten"](area);
 way["amenity"="biergarten"](area);
 rel["amenity"="biergarten"](area);
);
out center;
"""
response = requests.get(overpass_url,
                        params={'data': overpass_query})
data = response.json()
```

* Testing queries to the Overpass API using __[Overpass Turbo](https://overpass-turbo.eu/)__. There is an auto-repair function and a wizard generation function as well: How convenient! Here is a __[wiki page on the Overpass turbo/Wizard](https://wiki.openstreetmap.org/wiki/Overpass_turbo/Wizard)__
```
/*
This has been generated by the overpass-turbo wizard.
The original search was:
“river”
*/
[out:json][timeout:25];
// gather results
(
  // query part for: “river”
  way["waterway"="river"]({{bbox}});
);
// print results
out body;
>;
out skel qt;
```
Better to use `waterway` as key rather than `water` (since `water` seems to return smaller streams as well).
* __[OSMPythonTools](https://github.com/mocnik-science/osm-python-tools)__: "The python package OSMPythonTools provides easy access to OpenStreetMap (OSM) related services, among them an Overpass endpoint, Nominatim, and the OSM API." : This helps me identify how to request data on water bodies.
```python
from OSMPythonTools.overpass import overpassQueryBuilder, Overpass
overpass = Overpass()
query = overpassQueryBuilder(area=areaId, elementType=['way', 'relation'], selector='"natural"="water"', includeGeometry=True)
result = overpass.query(query)
```
* __[Overpass API Language Guide](https://wiki.openstreetmap.org/wiki/Overpass_API/Language_Guide)__

Issue : size of the data returned over the whole area.
-> Use a combination of spatial filtering and feature simplification technique
* Spatial filtering:apply a more selective filter to retrieve only the features that are relevant to my use case. This modified query retrieves only the ways that are tagged as a river and have a length greater than 10,000 meters, within the bounding box specified by "bbox".
```
way["waterway"="river"]["length" > 10000](bbox);
```

* Feature simplification: Once the relevant features are retrieved, they can be simplified to reduce the amount of data in the GeoJSON file. I've used Mapshaper (www.mapshaper.org) :

[TO DO]
* define the map area (northeast, southwest): cf. __[bounding box](https://wiki.openstreetmap.org/wiki/Overpass_API/Language_Guide#The_bounding_box)__
* extract river data
* simplify river Data
* load GeoJSON file in Observable 
* identify whether lake should also be extracted
